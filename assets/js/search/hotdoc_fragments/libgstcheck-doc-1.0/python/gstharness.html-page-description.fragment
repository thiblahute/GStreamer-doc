fragment_downloaded_cb({"url": "libgstcheck-doc-1.0/python/gstharness.html#page-description", "fragment": "<div id=\"page-description\" data-hotdoc-source=\"gstharness.h\">\n<h1 id=\"gstharness\">GstHarness</h1><p><a href=\"gstharness.html#GstHarness\">GstCheck.Harness</a> is meant to make writing unit test for GStreamer much easier.\nIt can be thought of as a way of treating a <a href=\"../../libgstreamer-doc-1.0/c/gstelement.html#GstElement\">Gst.Element</a> as a black box,\ndeterministically feeding it data, and controlling what data it outputs.</p>\n<p>The basic structure of <a href=\"gstharness.html#GstHarness\">GstCheck.Harness</a> is two \"floating\" <a href=\"../../libgstreamer-doc-1.0/c/gstpad.html#GstPad\">Gst.Pad</a> that connect\nto the harnessed <a href=\"../../libgstreamer-doc-1.0/c/gstelement.html#GstElement\">Gst.Element</a> src and sink <a href=\"../../libgstreamer-doc-1.0/c/gstpad.html#GstPad\">Gst.Pad</a> like so:</p>\n<pre><code class=\"language-[\">           __________________________\n  _____   |  _____            _____  |   _____\n |     |  | |     |          |     | |  |     |\n | src |--+-| sink|  Element | src |-+--| sink|\n |_____|  | |_____|          |_____| |  |_____|\n          |__________________________|\n\n</code></pre>\n<p>With this, you can now simulate any environment the <a href=\"../../libgstreamer-doc-1.0/c/gstelement.html#GstElement\">Gst.Element</a> might find\nitself in. By specifying the <a href=\"../../libgstreamer-doc-1.0/c/gstcaps.html#GstCaps\">Gst.Caps</a> of the harness <a href=\"../../libgstreamer-doc-1.0/c/gstpad.html#GstPad\">Gst.Pad</a>, using\nfunctions like <a href=\"gstharness.html#gst_harness_set_src_caps\">GstCheck.Harness.set_src_caps</a> or <a href=\"gstharness.html#gst_harness_set_sink_caps_str\">GstCheck.Harness.set_sink_caps_str</a>,\nyou can test how the <a href=\"../../libgstreamer-doc-1.0/c/gstelement.html#GstElement\">Gst.Element</a> interacts with different caps sets.</p>\n<p>Your harnessed <a href=\"../../libgstreamer-doc-1.0/c/gstelement.html#GstElement\">Gst.Element</a> can of course also be a bin, and using\n<a href=\"../c/gstharness.html#gst_harness_new_parse\">gst_harness_new_parse (not introspectable)</a> supporting standard gst-launch syntax, you can\neasily test a whole pipeline instead of just one element.</p>\n<p>You can then go on to push <a href=\"../../libgstreamer-doc-1.0/c/gstbuffer.html#GstBuffer\">Gst.Buffer</a> and <a href=\"../../libgstreamer-doc-1.0/c/gstevent.html#GstEvent\">Gst.Event</a> on to the srcpad,\nusing functions like <a href=\"gstharness.html#gst_harness_push\">GstCheck.Harness.push</a> and <a href=\"gstharness.html#gst_harness_push_event\">GstCheck.Harness.push_event</a>, and\nthen pull them out to examine them with <a href=\"gstharness.html#gst_harness_pull\">GstCheck.Harness.pull</a> and\n<a href=\"gstharness.html#gst_harness_pull_event\">GstCheck.Harness.pull_event</a>.</p>\n<h2 id=\"a-simple-bufferin-bufferout-example\">A simple buffer-in buffer-out example</h2>\n<pre><code class=\"language-[&lt;!--\">   #include &lt;gst/gst.h&gt;\n   #include &lt;gst/check/gstharness.h&gt;\n   GstHarness *h;\n   GstBuffer *in_buf;\n   GstBuffer *out_buf;\n\n   // attach the harness to the src and sink pad of GstQueue\n   h = gst_harness_new (\"queue\");\n\n   // we must specify a caps before pushing buffers\n   gst_harness_set_src_caps_str (h, \"mycaps\");\n\n   // create a buffer of size 42\n   in_buf = gst_harness_create_buffer (h, 42);\n\n   // push the buffer into the queue\n   gst_harness_push (h, in_buf);\n\n   // pull the buffer from the queue\n   out_buf = gst_harness_pull (h);\n\n   // validate the buffer in is the same as buffer out\n   fail_unless (in_buf == out_buf);\n\n   // cleanup\n   gst_buffer_unref (out_buf);\n   gst_harness_teardown (h);\n\n</code></pre>\n<p>Another main feature of the <a href=\"gstharness.html#GstHarness\">GstCheck.Harness</a> is its integration with the\n<a href=\"gsttestclock.html#GstTestClock\">GstCheck.TestClock</a>. Operating the <a href=\"gsttestclock.html#GstTestClock\">GstCheck.TestClock</a> can be very challenging, but\n<a href=\"gstharness.html#GstHarness\">GstCheck.Harness</a> simplifies some of the most desired actions a lot, like wanting\nto manually advance the clock while at the same time releasing a <a href=\"../../libgstreamer-doc-1.0/c/gstclock.html#GstClockID\">Gst.ClockID</a>\nthat is waiting, with functions like <a href=\"gstharness.html#gst_harness_crank_single_clock_wait\">GstCheck.Harness.crank_single_clock_wait</a>.</p>\n<p><a href=\"gstharness.html#GstHarness\">GstCheck.Harness</a> also supports sub-harnesses, as a way of generating and\nvalidating data. A sub-harness is another <a href=\"gstharness.html#GstHarness\">GstCheck.Harness</a> that is managed by\nthe \"parent\" harness, and can either be created by using the standard\ngst_harness_new type functions directly on the (GstHarness *)-&gt;src_harness,\nor using the much more convenient <a href=\"gstharness.html#gst_harness_add_src\">GstCheck.Harness.add_src</a> or\n<a href=\"gstharness.html#gst_harness_add_sink_parse\">GstCheck.Harness.add_sink_parse</a>. If you have a decoder-element you want to test,\n(like vp8dec) it can be very useful to add a src-harness with both a\nsrc-element (videotestsrc) and an encoder (vp8enc) to feed the decoder data\nwith different configurations, by simply doing:</p>\n<pre><code class=\"language-[&lt;!--\">   GstHarness * h = gst_harness_new (h, \"vp8dec\");\n   gst_harness_add_src_parse (h, \"videotestsrc is-live=1 ! vp8enc\", TRUE);\n</code></pre>\n<p>and then feeding it data with:</p>\n<pre><code class=\"language-[&lt;!--\"> gst_harness_push_from_src (h);\n</code></pre>\n\n</div>\n\n\n"});